<app-header></app-header>
            <!-- Drop Down Task -->
        <div class="dropdowns" style="margin-left: 20px;" *ngIf="calibrationDone">
            <div>
                <span class="dropdown-label">Task: </span>
                <select [(ngModel)]="randomizationService.selectedTask" (change)="randomizationService.selectTask()"> 
                    <option *ngFor="let item of TaskType | keyvalue">{{item.value}}</option>
                </select>
            </div>
            
            <!-- Drop Down InputType -->
            <div>
                <span class="dropdown-label">Input variant: </span>
                <select [(ngModel)]="randomizationService.selectedInputType" (change)="randomizationService.selectInputType()" > 
                    <option *ngFor="let item of InputType | keyvalue">{{item.value}}</option>
                </select>
            </div>
            <button (click)="confirmSelection()">Select</button>
        </div>

        <!-- <button (click)="taskEvaluationService.startTask()">Start</button>
        <button (click)="taskEvaluationService.endTask()">End</button>
        <button (click)="taskEvaluationService.exportResults()">Export</button> -->

<div *ngIf="!webgazerService.webgazerLoaded"> <!-- style="display:flex;justify-content:center;align-items:center;width:100%;height:100%;" -->
    <div class="popup-full-background"></div>
    <div class="Popup">            
        <mat-spinner [diameter]="30" ></mat-spinner>
        <div>
            Please wait. Everything is being prepared...
        </div>            
        <div style="padding-top: 30px; font-weight: bold;">
            If your browser asks for permission to use your camera, please click "Allow".
        </div>        
    </div>
</div>

<div class="button-header-container">
    <button class="button-header" style="margin: 0px 10px;" type="button" *ngIf="!calibrationDone"
        (click)="calibrationDone = true;">Skip callibration
    </button>
    <span *ngIf="!webgazerService.paused">
        <button  class="button-header" mat-icon-button style="margin: 0px 0px;" type="button" (click)="webgazerService.togglePauseWebgazer()">
            <mat-icon>pause</mat-icon>
        </button>
    </span>
    <span *ngIf="webgazerService.paused">
        <button class="button-header" mat-icon-button style="margin: 0px 10px;" type="button" (click)="webgazerService.togglePauseWebgazer()">
            <mat-icon>play_arrow</mat-icon>
        </button>
    </span>
    <button *ngIf="!calibrationDone" class="button-header" mat-icon-button style="margin: 0px 10px;" type="button" (click)="showExplanation();">
        <mat-icon>question_mark</mat-icon>
    </button>
    <div style="background-color: white; border-radius: 15px; padding: 5px; display: flex; justify-content: space-between; margin-top: 20px; margin-bottom: 20px;">
        <span style="color: var(--green); font-size: 40px;" *ngFor="let rep of randomizationService.reps; index as i">
            <span *ngIf="i + 1 <= randomizationService.repsDone">●</span>
            <span style="color: var(--green);" *ngIf="i + 1 > randomizationService.repsDone">○</span>
        </span>
    </div>
</div>
        

<!-- content -->
<div class="content" *ngIf="webgazerService.webgazerLoaded">

    <span class="angle">❯</span>
    <div class="instructions">{{randomizationService.instructions}}</div>

    <app-calibration *ngIf="!calibrationDone && !randomizationService.everythingDone" 
        (calibrationDoneEvent)="setCalibrationDone($event)">
    </app-calibration>

    <app-final-page *ngIf="randomizationService.everythingDone || randomizationService.showQuestionnaireInfo"></app-final-page>
    
    <div *ngIf="calibrationDone && !(randomizationService.everythingDone || randomizationService.showQuestionnaireInfo)">
         <div id="experimentSandbox">
            <app-click *ngIf="(randomizationService.selectedTask$ | async) == TaskType.SELECT"></app-click>
            <app-hover *ngIf="(randomizationService.selectedTask$ | async) == TaskType.HOVER"></app-hover>                
            <app-scroll *ngIf="(randomizationService.selectedTask$ | async) == TaskType.SCROLL"></app-scroll>
            <img id="arrow" class="arrow" src="/assets/arrow.png" />
        </div>

        <div *ngIf="showPopup" style="display:flex;justify-content:center;">
                <div class="popup-background"></div> 
                <div class="Popup">
                    <div class="popup-header">
                        <span>Good job!</span> 
                        <!-- TODO: separate calibration popup, this one is just for explanations -->
                    </div>
                    <h2>Your task now:</h2>
                    <div style="margin-bottom: 25px;">{{randomizationService.instructions}}</div>
                    <button (click)="showPopup=false; confirmSelection()">Got it!</button>
                </div>
        </div>
    </div>
</div>